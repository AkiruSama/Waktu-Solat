<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waktu Solat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Amiri&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .font-amiri { font-family: 'Amiri', serif; line-height: 1.8; }
        
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0.8; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }
        .animate-fall {
            position: fixed;
            pointer-events: none;
            z-index: 50;
            animation: fall linear forwards;
        }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 12s linear infinite;
        }
        .rtl { direction: rtl; }
        .transition-theme { transition: background-color 0.4s, color 0.4s, border-color 0.4s; }
        
        .dark-mode::-webkit-scrollbar { width: 8px; }
        .dark-mode::-webkit-scrollbar-track { background: #0f172a; }
        .dark-mode::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen transition-theme overflow-x-hidden bg-[#f8fafc] text-slate-900" id="body-root">
    
    <!-- Latar Belakang Dekoratif -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div id="glow-1" class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] blur-[120px] rounded-full bg-emerald-500/10"></div>
        <div id="glow-2" class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] blur-[120px] rounded-full bg-blue-500/10"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8 max-w-4xl">
        <!-- Kawalan Atas -->
        <div class="flex justify-between items-center mb-4">
            <div id="location-status" class="text-[10px] font-bold uppercase tracking-wider transition-theme px-3 py-1 rounded-full border flex items-center gap-2">
                <i data-lucide="map-pin" class="w-3 h-3"></i>
                <span id="status-text">Mengesan Lokasi...</span>
            </div>
            <button id="theme-toggle" class="p-3 rounded-2xl border transition-all shadow-sm">
                <i data-lucide="moon" class="w-5 h-5" id="theme-icon"></i>
            </button>
        </div>

        <!-- Bahagian Pengepala -->
        <header class="flex flex-col items-center mb-10 space-y-4">
            <div id="logo-box" class="w-20 h-20 rounded-3xl flex items-center justify-center border shadow-xl transition-theme">
                <i data-lucide="moon" class="w-10 h-10" id="logo-icon"></i>
            </div>
            <div class="text-center">
                <h1 class="text-4xl font-bold tracking-tight bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                    Waktu Solat
                </h1>
                <p id="current-date" class="mt-2 flex items-center justify-center gap-2 font-medium transition-theme">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    Memuatkan takwim...
                </p>
            </div>
        </header>

        <!-- Baris Tarikh Penting -->
        <div id="dates-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"></div>

        <!-- Antaramuka Utama -->
        <main class="space-y-6">
            <!-- Pemilih Zon & Waktu -->
            <div id="selector-card" class="p-6 rounded-3xl shadow-xl border transition-theme overflow-hidden relative">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 relative z-10">
                    <div class="flex-1 space-y-2">
                        <label id="zone-label" class="text-sm font-semibold flex items-center gap-2 transition-theme">
                            <i data-lucide="map-pin" class="w-4 h-4 text-emerald-600"></i>
                            Zon Penempatan
                        </label>
                        <div class="relative">
                            <select id="zone-select" class="w-full p-3.5 rounded-xl appearance-none focus:outline-none focus:ring-2 focus:ring-emerald-500/40 border transition-theme cursor-pointer font-medium">
                                <!-- Zon disuntik JS -->
                            </select>
                            <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 pointer-events-none text-slate-400"></i>
                        </div>
                    </div>

                    <div class="flex flex-col items-center md:items-end justify-center px-6 py-2 border-l transition-theme" id="time-divider">
                        <div class="flex items-center gap-2 text-emerald-600 mb-1">
                            <i data-lucide="clock" class="w-4 h-4 animate-spin-slow"></i>
                            <span class="text-xs font-bold uppercase tracking-widest">Waktu Semasa</span>
                        </div>
                        <div id="live-clock" class="text-3xl font-mono font-black transition-theme">00:00:00</div>
                    </div>
                </div>
            </div>

            <!-- Grid Waktu Solat -->
            <div class="space-y-3">
                <div class="flex items-center justify-between px-2">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-slate-400">Jadual Solat Hari Ini</h3>
                    <div id="jakim-badge" class="flex items-center gap-1.5 text-[10px] font-bold text-emerald-600 uppercase">
                        <i data-lucide="shield-check" class="w-3 h-3"></i>
                        Data Rasmi JAKIM
                    </div>
                </div>
                <div id="prayer-grid" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div>
            </div>

            <!-- Bahagian Al-Quran -->
            <section id="quran-card" class="p-8 md:p-12 rounded-[2rem] text-center relative overflow-hidden group border transition-theme shadow-lg">
                <div class="absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                    <i data-lucide="book-open" class="w-32 h-32"></i>
                </div>
                <div class="relative z-10">
                    <h2 class="text-emerald-600 text-xs font-black uppercase tracking-[0.3em] mb-10 flex items-center justify-center gap-3">
                        <span class="h-[px] w-8 bg-emerald-600/20"></span>
                        Ayat Al-Quran Pilihan
                        <span class="h-[1px] w-8 bg-emerald-600/20"></span>
                    </h2>
                    <!-- Teks Arab dengan leading/spacing yang lebih baik -->
                    <p id="quran-text" class="text-3xl md:text-5xl font-amiri mb-10 rtl px-4 transition-theme">
                        ...
                    </p>
                    <div id="quran-ref" class="inline-block px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider transition-theme border">
                        â€” Memuatkan rujukan
                    </div>
                </div>
            </section>
        </main>

        <!-- Kaki Laman -->
        <footer class="mt-16 text-center space-y-6 pb-8">
            <div class="flex flex-wrap items-center justify-center gap-4 text-slate-500">
                <a href="#" id="feedback-btn" class="flex items-center gap-2 transition-all px-5 py-2.5 rounded-full border text-xs font-bold shadow-sm">
                    <i data-lucide="message-square" class="w-4 h-4"></i>
                    Maklum Balas
                </a>
            </div>
            <p id="footer-text" class="text-[10px] uppercase tracking-[0.2em] font-black transition-theme">
                &copy; <span id="copyright-year"></span> Muhammad Aqil â€¢ Pembangunan Aplikasi Patuh Syariah
            </p>
        </footer>
    </div>

    <script>
        const ZONES = {
            "Wilayah Persekutuan": [
                { value: "WLY01", label: "Kuala Lumpur, Putrajaya", lat: 3.139, lng: 101.686 },
                { value: "WLY02", label: "Labuan", lat: 5.283, lng: 115.243 }
            ],
            "Selangor": [
                { value: "SGR01", label: "Gombak, Petaling, Sepang, Shah Alam", lat: 3.073, lng: 101.518 },
                { value: "SGR02", label: "Kuala Selangor, Sabak Bernam", lat: 3.333, lng: 101.250 },
                { value: "SGR03", label: "Klang, Kuala Langat", lat: 3.044, lng: 101.445 }
            ],
            "Johor": [
                { value: "JHR02", label: "Johor Bahru, Kota Tinggi, Kulai", lat: 1.485, lng: 103.761 },
                { value: "JHR04", label: "Batu Pahat, Muar, Segamat", lat: 1.854, lng: 102.932 }
            ],
            "Kedah": [
                { value: "KDH01", label: "Kota Setar, Kubang Pasu", lat: 6.118, lng: 100.368 },
                { value: "KDH06", label: "Langkawi", lat: 6.350, lng: 99.800 }
            ],
            "Kelantan": [
                { value: "KTN01", label: "Kota Bharu, Pasir Mas, Tumpat", lat: 6.125, lng: 102.238 }
            ],
            "Melaka": [
                { value: "MLK01", label: "Seluruh Negeri Melaka", lat: 2.189, lng: 102.249 }
            ],
            "Negeri Sembilan": [
                { value: "NGS03", label: "Port Dickson, Seremban", lat: 2.725, lng: 101.942 }
            ],
            "Pahang": [
                { value: "PHG02", label: "Kuantan, Pekan", lat: 3.807, lng: 103.326 }
            ],
            "Perak": [
                { value: "PRK02", label: "Ipoh, Batu Gajah", lat: 4.597, lng: 101.090 }
            ],
            "Pulau Pinang": [
                { value: "PNG01", label: "Seluruh Negeri", lat: 5.414, lng: 100.328 }
            ],
            "Sabah": [
                { value: "SBH07", label: "Kota Kinabalu, Penampang", lat: 5.980, lng: 116.075 }
            ],
            "Terengganu": [
                { value: "TRG01", label: "Kuala Terengganu, Marang", lat: 5.330, lng: 103.140 }
            ]
        };

        const IMPORTANT_DATES = [
            { name: "Awal Ramadhan 1447H", date: new Date("2026-02-18"), end: new Date("2026-03-19"), emoji: "ðŸŒ™" },
            { name: "Hari Raya Aidilfitri", date: new Date("2026-03-20"), end: new Date("2026-03-22"), emoji: "âœ¨" },
            { name: "Hari Raya Aidiladha", date: new Date("2026-05-27"), end: new Date("2026-05-30"), emoji: "ðŸ‘" },
            { name: "Awal Muharram 1448H", date: new Date("2026-06-16"), end: new Date("2026-06-16"), emoji: "ðŸ•‹" }
        ];

        const PRAYER_LABELS = { imsak: "Imsak", fajr: "Subuh", syuruk: "Syuruk", dhuha: "Dhuha", dhuhr: "Zohor", asr: "Asar", maghrib: "Maghrib", isha: "Isyak" };

        let currentZone = "WLY01";
        let isDarkMode = false; 
        let prayerTimes = null;
        let confettiInterval = null;

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function detectUserLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    let closestZone = "WLY01";
                    let minDistance = Infinity;

                    Object.values(ZONES).flat().forEach(zone => {
                        const dist = calculateDistance(userLat, userLng, zone.lat, zone.lng);
                        if (dist < minDistance) {
                            minDistance = dist;
                            closestZone = zone.value;
                        }
                    });

                    currentZone = closestZone;
                    document.getElementById('zone-select').value = currentZone;
                    document.getElementById('status-text').innerText = "Lokasi Dikesan";
                    fetchPrayerTimes();
                }, () => {
                    document.getElementById('status-text').innerText = "Guna Lokasi Manual";
                });
            }
        }

        function formatTime(timeStr) {
            if (!timeStr) return "--:--";
            const [h, m] = timeStr.split(':').map(Number);
            const period = h >= 12 ? 'PM' : 'AM';
            const hour = h % 12 || 12;
            return `${hour}:${m.toString().padStart(2, '0')} ${period}`;
        }

        function triggerConfetti(emoji) {
            // Pengurangan count untuk effect lebih minimal
            const count = 2; 
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = 'animate-fall';
                p.innerText = emoji;
                p.style.left = Math.random() * 100 + '%';
                p.style.top = '-5%';
                p.style.fontSize = (Math.random() * 15 + 15) + 'px';
                p.style.animationDuration = (Math.random() * 5 + 6) + 's';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 10000);
            }
        }

        function checkCelebration() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const activeEvent = IMPORTANT_DATES.find(event => {
                const s = new Date(event.date.getFullYear(), event.date.getMonth(), event.date.getDate());
                const e = new Date(event.end.getFullYear(), event.end.getMonth(), event.end.getDate());
                return today >= s && today <= e;
            });

            if (activeEvent) {
                if (!confettiInterval) {
                    // Jeda masa lebih lama antara confetti
                    confettiInterval = setInterval(() => triggerConfetti(activeEvent.emoji), 4000);
                }
            } else {
                if (confettiInterval) {
                    clearInterval(confettiInterval);
                    confettiInterval = null;
                }
            }
        }

        function updateTheme() {
            const root = document.getElementById('body-root');
            const icon = document.getElementById('theme-icon');
            const logoBox = document.getElementById('logo-box');
            const logoIcon = document.getElementById('logo-icon');
            const selectorCard = document.getElementById('selector-card');
            const quranCard = document.getElementById('quran-card');
            const g1 = document.getElementById('glow-1');
            const g2 = document.getElementById('glow-2');
            const qTxt = document.getElementById('quran-text');
            const qRef = document.getElementById('quran-ref');
            const zoneSelect = document.getElementById('zone-select');
            const clock = document.getElementById('live-clock');
            const locationStatus = document.getElementById('location-status');
            const themeToggle = document.getElementById('theme-toggle');
            const currentDate = document.getElementById('current-date');
            const zoneLabel = document.getElementById('zone-label');
            const timeDivider = document.getElementById('time-divider');
            const feedbackBtn = document.getElementById('feedback-btn');
            const jakimBadge = document.getElementById('jakim-badge');
            const footerText = document.getElementById('footer-text');

            if (isDarkMode) {
                root.className = "min-h-screen transition-theme overflow-x-hidden bg-[#0f172a] text-slate-100 dark-mode";
                icon.setAttribute('data-lucide', 'sun');
                icon.className = "w-5 h-5 text-amber-400";
                themeToggle.className = "p-3 rounded-2xl border transition-all shadow-sm bg-slate-800 border-slate-700 hover:bg-slate-700";
                
                logoBox.className = "w-20 h-20 rounded-3xl flex items-center justify-center border shadow-xl bg-emerald-500/10 border-emerald-500/30 shadow-emerald-500/5";
                logoIcon.className = "w-10 h-10 text-emerald-400 fill-emerald-400/20";
                
                locationStatus.className = "text-[10px] font-bold uppercase tracking-wider text-emerald-400 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20 flex items-center gap-2";
                currentDate.className = "mt-2 flex items-center justify-center gap-2 font-medium text-slate-400";
                
                selectorCard.className = "p-6 rounded-3xl shadow-xl border bg-slate-800 border-slate-700";
                zoneLabel.className = "text-sm font-semibold flex items-center gap-2 text-slate-300";
                zoneSelect.className = "w-full p-3.5 rounded-xl appearance-none focus:outline-none focus:ring-2 focus:ring-emerald-500/40 bg-slate-900 border-slate-700 text-white cursor-pointer font-medium";
                timeDivider.className = "flex flex-col items-center md:items-end justify-center px-6 py-2 border-l border-slate-700";
                clock.className = "text-3xl font-mono font-black text-white";
                
                quranCard.className = "p-8 md:p-12 rounded-[2rem] text-center relative overflow-hidden group border bg-slate-800 border-slate-700";
                qTxt.className = "text-3xl md:text-5xl font-amiri mb-10 rtl px-4 text-emerald-50";
                qRef.className = "inline-block px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-emerald-500/10 text-emerald-400 border border-emerald-500/20";
                
                g1.className = "absolute top-[-10%] left-[-10%] w-[40%] h-[40%] blur-[120px] rounded-full bg-emerald-900/30";
                g2.className = "absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] blur-[120px] rounded-full bg-blue-900/30";
                
                feedbackBtn.className = "flex items-center gap-2 transition-all px-5 py-2.5 rounded-full border text-xs font-bold bg-slate-800 border-slate-700 text-slate-300 hover:text-emerald-400";
                jakimBadge.className = "flex items-center gap-1.5 text-[10px] font-bold text-emerald-500 uppercase";
                footerText.className = "text-slate-500 text-[10px] uppercase tracking-[0.2em] font-black";
            } else {
                root.className = "min-h-screen transition-theme overflow-x-hidden bg-[#f8fafc] text-slate-900";
                icon.setAttribute('data-lucide', 'moon');
                icon.className = "w-5 h-5 text-slate-600";
                themeToggle.className = "p-3 rounded-2xl border transition-all shadow-sm bg-white border-slate-200 hover:bg-slate-50";
                
                logoBox.className = "w-20 h-20 rounded-3xl flex items-center justify-center border shadow-xl bg-white border-emerald-100 shadow-emerald-500/10";
                logoIcon.className = "w-10 h-10 text-emerald-600";
                
                locationStatus.className = "text-[10px] font-bold uppercase tracking-wider text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full border border-emerald-100 flex items-center gap-2";
                currentDate.className = "mt-2 flex items-center justify-center gap-2 font-medium text-slate-500";
                
                selectorCard.className = "p-6 rounded-3xl shadow-xl border bg-white border-slate-200";
                zoneLabel.className = "text-sm font-semibold flex items-center gap-2 text-slate-500";
                zoneSelect.className = "w-full p-3.5 rounded-xl appearance-none focus:outline-none focus:ring-2 focus:ring-emerald-500/40 bg-slate-50 border-slate-200 text-slate-800 cursor-pointer font-medium";
                timeDivider.className = "flex flex-col items-center md:items-end justify-center px-6 py-2 border-l border-slate-100";
                clock.className = "text-3xl font-mono font-black text-slate-800";
                
                quranCard.className = "p-8 md:p-12 rounded-[2rem] text-center relative overflow-hidden group border bg-white border-slate-200 shadow-lg";
                qTxt.className = "text-3xl md:text-5xl font-amiri mb-10 rtl px-4 text-slate-800";
                qRef.className = "inline-block px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-emerald-50 text-emerald-700 border border-emerald-100";
                
                g1.className = "absolute top-[-10%] left-[-10%] w-[40%] h-[40%] blur-[120px] rounded-full bg-emerald-500/10";
                g2.className = "absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] blur-[120px] rounded-full bg-blue-500/10";
                
                feedbackBtn.className = "flex items-center gap-2 transition-all px-5 py-2.5 rounded-full border text-xs font-bold bg-white border-slate-200 text-slate-500 hover:text-emerald-600";
                jakimBadge.className = "flex items-center gap-1.5 text-[10px] font-bold text-emerald-600 uppercase";
                footerText.className = "text-slate-400 text-[10px] uppercase tracking-[0.2em] font-black";
            }
            lucide.createIcons();
            renderPrayerTimes();
            renderDates();
        }

        async function fetchPrayerTimes() {
            try {
                const response = await fetch(`https://corsproxy.io/?https://www.e-solat.gov.my/index.php?r=esolatApi/TakwimSolat&period=week&zone=${currentZone}`);
                const data = await response.json();
                prayerTimes = data.prayerTime[0];
                renderPrayerTimes();
            } catch (e) {
                console.error("Fetch Error:", e);
            }
        }

        function renderPrayerTimes() {
            const grid = document.getElementById('prayer-grid');
            if (!grid) return;
            grid.innerHTML = '';
            const now = new Date();
            let activeKey = null;

            if (prayerTimes) {
                const order = ["imsak", "fajr", "syuruk", "dhuha", "dhuhr", "asr", "maghrib", "isha"];
                for (const key of order) {
                    const [h, m] = prayerTimes[key].split(':').map(Number);
                    const pDate = new Date();
                    pDate.setHours(h, m, 0);
                    if (now >= pDate) activeKey = key;
                }

                order.forEach(key => {
                    const isActive = activeKey === key;
                    const card = document.createElement('div');
                    card.className = `relative overflow-hidden group p-5 rounded-2xl border transition-all duration-300 ${
                        isActive 
                        ? 'bg-emerald-600 border-emerald-600 scale-105 shadow-xl shadow-emerald-500/20' 
                        : isDarkMode ? 'bg-slate-800 border-slate-700 hover:bg-slate-700 shadow-sm' : 'bg-white border-slate-200 hover:bg-emerald-50 shadow-sm'
                    }`;

                    let label = PRAYER_LABELS[key];
                    if (key === 'dhuhr' && now.getDay() === 5) label = "Jumaat";

                    card.innerHTML = `
                        ${isActive ? '<div class="absolute top-2 right-2"><i data-lucide="star" class="w-4 h-4 text-white fill-white animate-pulse"></i></div>' : ''}
                        <p class="text-xs font-bold mb-1 ${isActive ? 'text-white/80' : 'text-slate-500'}">${label}</p>
                        <p class="text-xl font-black font-mono ${isActive ? 'text-white' : isDarkMode ? 'text-white group-hover:text-emerald-400' : 'text-slate-800 group-hover:text-emerald-600'}">
                            ${formatTime(prayerTimes[key])}
                        </p>
                    `;
                    grid.appendChild(card);
                });
                lucide.createIcons();
            }
        }

        function renderDates() {
            const container = document.getElementById('dates-container');
            if (!container) return;
            container.innerHTML = '';
            IMPORTANT_DATES.forEach(item => {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const s = new Date(item.date.getFullYear(), item.date.getMonth(), item.date.getDate());
                const e = new Date(item.end.getFullYear(), item.end.getMonth(), item.end.getDate());
                const isLive = today >= s && today <= e;
                const status = isLive ? "KINI BERLANGSUNG" : (today > e ? "TELAH BERLALU" : `${Math.ceil((s - now) / (1000 * 60 * 60 * 24))} Hari Lagi`);
                
                const card = document.createElement('div');
                card.className = `group p-4 rounded-2xl border transition-all relative overflow-hidden ${
                    isLive 
                    ? 'border-emerald-600 bg-emerald-500/10 scale-[1.02] shadow-lg shadow-emerald-500/10' 
                    : isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200 shadow-sm'
                }`;

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-1">
                        <p class="text-[10px] uppercase tracking-wider font-bold ${isLive ? 'text-emerald-400' : 'text-slate-500'}">${item.name}</p>
                        ${isLive ? '<i data-lucide="sparkles" class="w-3 h-3 text-emerald-600 animate-pulse"></i>' : ''}
                    </div>
                    <p class="text-lg font-bold flex items-center gap-2 ${isLive ? 'text-emerald-500' : isDarkMode ? 'text-emerald-400' : 'text-emerald-600'}">
                        ${item.emoji} ${status}
                    </p>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        async function fetchQuran() {
            try {
                const res = await fetch('https://api.alquran.cloud/v1/ayah/random/quran-uthmani');
                const data = await res.json();
                if (data.data) {
                    document.getElementById('quran-text').innerText = data.data.text;
                    document.getElementById('quran-ref').innerText = `â€” ${data.data.surah.englishName} (${data.data.numberInSurah})`;
                }
            } catch (e) {
                console.error("Quran Fetch Error:", e);
                document.getElementById('quran-text').innerText = "Ø¥ÙÙ†Ù‘ÙŽ Ù…ÙŽØ¹ÙŽ Ù±Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§";
                document.getElementById('quran-ref').innerText = "â€” Ash-Sharh (6)";
            }
        }

        setInterval(() => {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toLocaleTimeString('en-US', { hour12: false });
            document.getElementById('current-date').innerHTML = `<i data-lucide="calendar" class="w-4 h-4"></i> ${now.toLocaleDateString('ms-MY', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}`;
            checkCelebration();
        }, 1000);

        window.onload = () => {
            // Auto update copyright year
            document.getElementById('copyright-year').innerText = new Date().getFullYear();

            const select = document.getElementById('zone-select');
            Object.entries(ZONES).forEach(([state, districts]) => {
                const group = document.createElement('optgroup');
                group.label = state;
                districts.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d.value;
                    opt.innerText = d.label;
                    group.appendChild(opt);
                });
                select.appendChild(group);
            });

            select.onchange = (e) => {
                currentZone = e.target.value;
                document.getElementById('status-text').innerText = "Zon Manual";
                fetchPrayerTimes();
            };

            document.getElementById('theme-toggle').onclick = () => {
                isDarkMode = !isDarkMode;
                updateTheme();
            };

            updateTheme();
            detectUserLocation(); 
            fetchPrayerTimes();
            fetchQuran();
            renderDates();
        };
    </script>
</body>
</html>
